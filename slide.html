<html>
  <head>
    <link rel="stylesheet" href="slide.css">
  </head>
  <body>
    <div id="app">
      <carousel>
        <div class="slide"
             v-for="image in images"
             :style="{backgroundImage: 'url(./images/'+ image +')'}"
        ></div>
      </carousel>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.13/dist/vue.js"></script>
    <script>
      Vue.component('carousel', {
        data() {
          return {
            slides: [],
            currentSlide: 0,
            slideWidth: 0,
            transition: '.25s ease-out',
            windowHeight: null
          }
        },
        template: `
          <div>
            <div class="wrapper" :style="{height: windowHeight + 'px'}">
              <slot></slot>
            </div>
            <nav>
              <button @click="prev()">prev</button>
              <button @click="next()">next</button>
            </nav>
          </div>
        `,
        methods: {
          incrementSlide() {
            this.currentSlide = (this.currentSlide !== this.lastSlideIndex) ? this.currentSlide + 1 : this.currentSlide = 0
          },
          decrementSlide() {
            this.currentSlide = (this.currentSlide !== 0) ?  this.currentSlide - 1 : this.lastSlideIndex
          },
          slidesFirstPosition(slideIndex) {
            return (slideIndex === this.lastSlideIndex) ? -this.slideWidth : slideIndex * this.slideWidth
          },
          slideIsLeftOfWrapper(slideIndex) {
            return slideIndex === this.currentSlide - 1
          },
          positionSlideLeftOfWrapper() {
            return -1 * this.slideWidth
          },
          positionSlides(slideIndex) {
            if (this.slideIsLeftOfWrapper(slideIndex)) {
              return this.positionSlideLeftOfWrapper()
            }

            if (slideIndex === 0) {
              return (this.slides.length - this.currentSlide) * this.slideWidth
            } else {
              return (this.currentSlide > slideIndex) ?
                (this.currentSlide - slideIndex) * this.slideWidth
                : (slideIndex - this.currentSlide) * this.slideWidth
            }
          },
          getSlidesLeftPosition(slideIndex) {
            return (this.slidesAtStartingPosition) ? this.slidesFirstPosition(slideIndex) : this.positionSlides(slideIndex)
          },
          next() {
            this.incrementSlide()
            this.slides.forEach((slide, slideIndex) => {
              if (slideIndex === this.currentSlide || slideIndex === this.currentSlide - 1) {
                slide.elm.style.transition = this.transition
              } else {
                slide.elm.style.transition = (this.currentSlide === 0 && slideIndex === this.lastSlideIndex) ? this.transition : null
              }
              slide.elm.style.left = `${this.getSlidesLeftPosition(slideIndex)}px`
            })

          },
          prev() {
            this.decrementSlide()
            this.slides.forEach((slide, slideIndex) => {
              if (slideIndex === this.currentSlide || slideIndex === this.currentSlide + 1) {
                slide.elm.style.transition = this.transition
              } else {
                slide.elm.style.transition = (this.currentSlide === this.lastSlideIndex && slideIndex === 0) ? this.transition : null
              }
              slide.elm.style.left = `${this.getSlidesLeftPosition(slideIndex)}px`
            })
          }
        },
        computed: {
          slidesAtStartingPosition() {
            return this.currentSlide === 0
          },
          lastSlideIndex() {
            return this.slides.length - 1
          },
          prevSlideIndex() {
            return this.currentSlide - 1
          }
        },
        mounted() {
          this.slideWidth = this.$el.offsetWidth
          this.windowHeight = window.innerHeight
          this.slides = this.$slots.default.filter(slot => slot.elm.nodeName !== '#text')

          this.slides.forEach((slide, index) => {
            let left = this.slidesFirstPosition(index)
            slide.elm.style.left = `${left}px`
            slide.elm.style.height = `${window.innerHeight}px`
          })

          window.addEventListener('resize', () => {
            this.slides.forEach(slide => {
              // TODO need to throttle this
              slide.elm.style.height = `${window.innerHeight}px`
            })
          })
        }
      })

      new Vue({
        el: '#app',
        data: {
          images: [
            'IMG_3424.JPG',
            'IMG_3430.JPG',
            'IMG_3453.JPG',
            'IMG_3483.JPG',
          ]
        }
      })
    </script>
  </body>
</html>